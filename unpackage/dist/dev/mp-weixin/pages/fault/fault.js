require("../../common/manifest.js");
require("../../common/vendor.js");
global.webpackJsonp([10],{50:function(t,e,i){"use strict";var s=a(i(0)),n=a(i(51));function a(t){return t&&t.__esModule?t:{default:t}}new s.default(n.default).$mount()},51:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(53),n=i.n(s),a=i(54),o=!1;var r=function(t){o||i(52)},l=i(1)(n.a,a.a,r,null,null);l.options.__file="..\\..\\..\\..\\..\\allen\\project\\School-Admin\\pages\\fault\\fault.vue",l.esModule&&Object.keys(l.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)})&&console.error("named exports are not supported in *.vue files."),l.options.functional&&console.error("[vue-loader] fault.vue: functional components are not supported with templates, they should use render functions."),e.default=l.exports},52:function(t,e){},53:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var s,n=i(5),a=(s=n)&&s.__esModule?s:{default:s},o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},r=i(4);var l=i(3).utils;e.default={data:function(){return{title:"textarea",focus:!1,num:0,imageList:[],faultItems:[],reply_imgs:"",to_user:"",rec_id:"",tempFilePaths:"",text:"",room_id:""}},computed:(0,r.mapState)(["faults","fault_dev","lables"]),onLoad:function(t){console.log(t),this.rec_id=t.rec_id,this.to_user=t.to_user,this.room_id=t.room_id},methods:o({},(0,r.mapMutations)(["setFaults"]),{getLeng:function(t){this.num=t.detail.value.length,this.text=t.detail.value},getRecord:function(t){var e=t.target.dataset.idx;this.imageList.splice(e,1)},chooseImage:function(){var e,i=(e=a.default.mark(function e(){var i,s=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(4!==this.imageList.length){e.next=7;break}return e.next=3,this.isFullImg();case 3:if(i=e.sent,console.log("是否继续?",i),i){e.next=7;break}return e.abrupt("return");case 7:t.chooseImage({count:4,sizeType:["original"],sourceType:["album"],success:function(t){console.log(JSON.stringify(t.tempFilePaths)),s.tempFilePaths=t.tempFilePaths[0],s.imageList=s.imageList.concat(t.tempFilePaths),console.log(s.imageList)}});case 8:case"end":return e.stop()}},e,this)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function s(n,a){try{var o=t[n](a),r=o.value}catch(t){return void i(t)}if(!o.done)return Promise.resolve(r).then(function(t){s("next",t)},function(t){s("throw",t)});e(r)}("next")})});return function(){return i.apply(this,arguments)}}(),isFullImg:function(){var e=this;return new Promise(function(i){t.showModal({content:"已经有4张图片了,是否清空现有图片？",success:function(t){t.confirm?(e.imageList=[],i(!0)):i(!1)},fail:function(){i(!1)}})})},geteEuipment:function(){t.navigateTo({url:"../equipment/equipment?room_id="+this.room_id})},getSubmit:function(){if(0===this.num)t.showToast({title:"请输入故障描述",duration:2e3,icon:"none"});else{var e=this;if(0===e.imageList.length){if(0===e.faults.length)t.showToast({title:"至少选择一件故障设备",duration:2e3,icon:"none"});else if(e.faults.length>0){console.log(e.text);var i={action:"fault",reply_imgs:e.reply_imgs,reply_desc:"故障原因/修复过程:"+e.text+"<br />故障设备:"+String(e.lables).replace(",","、"),to_user:e.to_user,rec_id:e.rec_id,fault_dev:e.fault_dev};l.requestPost("operation/postreply",i,function(e){0===e.code&&t.navigateBack({delta:1})})}}else 0===e.faults.length?t.showToast({title:"至少选择一件故障设备",duration:2e3,icon:"none"}):e.faults.length>0&&(t.showToast({title:"正在上传图片",duration:800,icon:"none"}),t.uploadFile({url:"https://"+l.host+"/weixinweb/xiaochengcxufile/1",filePath:e.tempFilePaths,name:"upfile",success:function(i){var s=JSON.parse(i.data);e.reply_imgs=s.url;var n={action:"fault",status:9,reply_imgs:e.reply_imgs,reply_desc:"故障原因/修复过程:"+e.text+"<br />故障设备:"+e.lables[0],to_user:e.to_user,rec_id:e.rec_id,fault_dev:e.fault_dev};l.requestPost("operation/postreply",n,function(e){0===e.code&&t.navigateBack({delta:1})})}}))}this.setFaults("")}})}}).call(e,i(2).default)},54:function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("view",{staticClass:"coures"},[i("view",{staticClass:"page-section"},[i("view",{staticClass:"page-section-title"},[t._v("故障原因/修复过程")]),i("view",{staticClass:"textarea-wrp"},[i("textarea",{staticClass:"textare",attrs:{"placeholder-style":"color:#888888",placeholder:"请输入故障原因/修复过程",maxlength:"200",eventid:"lxf-0"},on:{input:t.getLeng}})]),i("view",{staticClass:"nums"},[i("view",{staticClass:"num"},[t._v("\n\t\t\t\t"+t._s(t.num)+"/200\n\t\t\t")])]),i("view",{staticClass:"page-section-title"},[t._v("相关照片")]),i("view",{staticClass:"picture"},[i("view",{staticClass:"uni-uploader__files"},t._l(t.imageList,function(e,s){return i("block",{key:s},[i("view",{staticClass:"uni-uploader__file attention"},[i("image",{staticClass:"uploader-img",attrs:{src:e,"data-src":e}}),i("view",{staticClass:"uni-icon-minus-filled uni-icon jians",attrs:{"data-idx":s,eventid:"x0U-1-"+s},on:{tap:t.getRecord}})])])})),i("view",{staticClass:"uni-uploader"},[i("view",{staticClass:"uploader-input",attrs:{eventid:"TBq-2"},on:{tap:t.chooseImage}},[i("image",{attrs:{src:"../../static/img/photo.png",mode:""}})])])]),i("view",{staticClass:"xuanz",attrs:{"hover-class":"uni-list-cell-hover",eventid:"86F-3"},on:{tap:t.geteEuipment}},[i("view",{staticClass:"left"},[t._v("\n\t\t\t\t故障设备\n\t\t\t")]),t._m(0)]),t._l(t.faults,function(e,s){return i("view",{key:s,staticClass:"uni-list-cell"},[i("view",{staticClass:"uni-list-cell-navigate"},[t._v("\n\t\t\t\t"+t._s(e)+"\n\t\t\t")])])})],2),i("view",{staticClass:"button",attrs:{"hover-class":"button-hover"}},[i("button",{staticClass:"mini-btn",attrs:{size:"mini","hover-class":"button-hover",eventid:"joR-4"},on:{tap:t.getSubmit}},[t._v("提交")])],1)])};s._withStripped=!0;var n={render:s,staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("view",{staticClass:"right"},[this._v("\n\t\t\t\t选择\n\t\t\t\t"),e("view",{staticClass:"icons uni-icon-arrowright uni-icon"})])}]};e.a=n}},[50]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/fault/fault.js.map